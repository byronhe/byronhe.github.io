
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>【翻译】密码学一小时必知 - Tech Ideas</title>
  <meta name="author" content="byronhe">

  
  <meta name="description" content="翻译了Colin Percival的ppt：Everything you need to know about cryptgraphy in 1 hour">
  <meta name="keywords" content="crypto, security,">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://blog.helong.info//blog/2015/04/12/translate-Everything-you-need-to-know-about-cryptgraphy-in-1-hour/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Tech Ideas" type="application/atom+xml">
  <!--
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-49290834-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  -->
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Tech Ideas</a></h1>
  
    <h2>C++,Linux,Algorithm,Crypto,Lisp,etc</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.helong.info/">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">【翻译】密码学一小时必知</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-12T14:05:55+00:00'><span class='date'>2015-04-12</span> <span class='time'>2:05 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>本文翻译了Colin Percival 于2010年在bsdcan的演讲ppt</p>

<p>原文标题：Everything you need to know about cryptography in 1 hour</p>

<p>演讲时间：May 13, 2010</p>

<p>原文在 <a href="https://www.bsdcan.org/2010/schedule/attachments/135_crypto1hr.pdf">https://www.bsdcan.org/2010/schedule/attachments/135_crypto1hr.pdf</a></p>

<p>演讲视频在 <a href="https://www.youtube.com/watch?v=jzY3m5Kv7Y8">https://www.youtube.com/watch?v=jzY3m5Kv7Y8</a> ( 请自行翻墙 )</p>

<p>Colin Percival 是密码学方面的专家，FreeBSD项目的安全长官，Tarsnap在线备份服务的创始人，scrypt密钥衍生算法的作者，致力于改进软件中密码学的应用，向程序员传播密码学的正确使用。</p>

<!--more-->


<hr />

<p>为什么要 cryptography in 1 hour：</p>

<p>因为有例如下面这些错误的使用案例：</p>

<ol>
<li><p>Google keyczar(时间通道攻击)</p></li>
<li><p>SSL( session renegotiation)</p></li>
<li><p>Amazon AWS 签名方法 (可能碰撞的签名算法)</p></li>
<li><p>Flicker API 签名(hash length-extension) 错误地使用了错误的工具</p></li>
<li><p>Intel Hyper Threading (architectual side channel) 不常用的环境</p></li>
<li><p>WEP,WPA,GSM&hellip;（多种漏洞）</p></li>
</ol>


<p>密码学被攻破通常是由于：</p>

<ol>
<li><p>愚蠢</p></li>
<li><p>使用了错误的工具，或者以错误的方式使用它们</p></li>
<li><p>不常用的环境</p></li>
</ol>


<hr />

<p>经验智慧：不要亲自写密码学代码！</p>

<ol>
<li>使用SSL做传输</li>
<li>使用GPG保护静止数据</li>
</ol>


<p>&ldquo;如果你在输入A-E-S到你的代码里，你已经开始犯错&rdquo; &ndash; Tomas Ptacek</p>

<p>现实：如果你无论如何都要写密码学代码，你最好知道你在干什么</p>

<p>现实：大多数应用程序只需要众所周知的标准模式的一个子集，而这是很容易保证正确的</p>

<p>55分钟后，你应该：</p>

<p>知道在99%的情况下应该怎么做</p>

<p>知道一些常见的错误在哪里</p>

<p>知道当你在做一些非标准的事情的时候，你真的需要咨询一个密码学专家</p>

<hr />

<p>密码学做保护，并对抗一些攻击，但不能对抗所有攻击：</p>

<p>贿赂，盗窃，敲诈</p>

<p>监狱刑罚</p>

<p>攻击人通常比攻击数据更贵</p>

<p>攻击人通常比攻击数据更危险</p>

<p>数据被拷打时不会开记者招待会来控诉</p>

<p>密码学的目的是强迫美国政府拷打你</p>

<p>希望他们认为你的信息不是这么重要</p>

<hr />

<p>密码学有3个主要目的：<em>加密 Encryption</em> ，<em>认证 Authentication </em>，<em>识别  Identification</em></p>

<ol>
<li>加密阻止恶意者读取你的数据</li>
<li>认证阻止恶意者在不被发现的情况下改动你的数据</li>
<li>识别阻止恶意者假装你</li>
</ol>


<p>有时认证和识别在一个步骤中进行：“这条消息自从我写下它之后没有被篡改”和“我是Colin”
可以替换成“这条消息自从Colin写下它之后没有被改过”</p>

<p>在大多数case里，你需要把2个，或者更多的密码学组件合起来使用</p>

<hr />

<p>概念定义</p>

<ol>
<li>plaintext是我们关心的数据</li>
<li>ciphertext是恶意者可以得到的数据</li>
<li>key用于在这两者之间做转换，有时候我们需要多个key</li>
</ol>


<p>对称密码学就是 ，使用相同的key，来把plaintext转换成ciphertext，和把ciphertext转换成
plaintext</p>

<p>非对称密码学就是，这两个方向的转换使用不同的key</p>

<p>理想的密码学组件并不存在，但是如果一个密码学组件被识别出不理想，一般就认为它是被攻破的</p>

<hr />

<p>hashing</p>

<p>一个理想的hash函数H(x)是一个函数映射，把任意长度的输入映射成n-bit的输出，
保证：</p>

<p><em>抵抗碰撞</em></p>

<p><em>单向</em></p>

<p>抵抗碰撞意味着需要 2<sup>n/2</sup>的时间来找到2个输入，使得它们的hash相同</p>

<p>单向意味着给定hash后，需要2<sup>n</sup>的时间来找到一个输入，使得它的hash是给定hash</p>

<p><em>没有保证任何其他性质</em></p>

<p>特别是：
知道H(x)可能允许一个攻击者计算某些y的H(y)</p>

<hr />

<p>实践：</p>

<p>使用 SHA-256</p>

<p>考虑切换到SHA-3，在未来5-10年内（2010年算起）</p>

<p>使用一个hash，如果你可以安全地分布 H(x)，并且想验证不安全地收到的x'实际上等于x</p>

<p>不要使用：MD2 MD4 MD5 SHA-1 RIPEMD</p>

<p>不要把 FreeBSD-8.0-RELEASE-amd64-disc1.iso和CHECKSUM.SHA256放到同一个FTP
服务器上，还以为自己干了件有用的事情</p>

<p>不要尝试把一个hash函数当成对称签名用</p>

<hr />

<p>对称认证</p>

<p>对称认证是通过提供一个消息认证码（MAC，message authentication code）来进行的。</p>

<p>一个理想的 MAC fk(x)使用一个key，来把任意长度的输入映射到n-bit的输出，确保需要 2<sup>n</sup>
的时间，一个攻击者才能在得到任意(x, fx(x))对的情况下，生成任意(y,fk(y))对。
有时MAC被称作随机函数</p>

<p>与hashing不同，知道fk(x)不能使你对另一个key计算出 fk(y)，</p>

<p> Flicker的API使用了hashing来认证API请求，他们实际需要的是 MAC</p>

<hr />

<p>对称认证</p>

<p>实践</p>

<p>使用 HMAC-SHA256</p>

<p>确保同样的输入，HMAC-SHA256不会生成不同的消息</p>

<p>Amazon和Flicker都做错了</p>

<p>不要使用 CBC-MAC</p>

<p>理论上安全，但是把你的块加密算法暴露给了攻击者</p>

<p>不要使用 Poly1305</p>

<p>太新，除非你是Daniel Bernstein(Poly 1305的发明者)，否则你基本不可能做出一个</p>

<p>安全和正确的实现</p>

<p>不要 当验证一个签名的时候，通过timing side channel的形式泄露信息</p>

<hr />

<p>Side channel 攻击</p>

<p>一个side channel 是攻击者除了ciphertext以外可以获取信息的任何方式</p>

<p>密码系统是以它们的数学设计被定义的，但是side channel 是由于密码系统的人工实现导致的。</p>

<p>最常见的side channel是timing &ndash; 你花费多长时间来 加密/解密/签名/验证 一个消息</p>

<p>其他side channel包括：电磁辐射，电力消耗，和微架构特征（例如L1缓存替换，在支持
HyperThreading的Intel CPU上）</p>

<hr />

<p>Side channel 攻击
实践</p>

<p>咨询一个密码学专家，如果你计划使恶意者可以物理接触到任何密码设备</p>

<p>咨询一个密码学专家，如果你计划允许恶意者在你允许密码学的物理硬件上运行代码(虚拟化系统)</p>

<p>咨询一个密码学专家，如果你计划发布一个以新方式泄露信息的CPU</p>

<p> intel可能做错了
不要写其运行时间泄露信息的代码</p>

<hr />

<p>Timing attacks</p>

<p>避免 依赖于key，或者依赖于plaintext的表查找</p>

<p>不要有依赖于key，或者依赖于plaintext的分支(if, for, while , foo?bar:baz 等代码指令)</p>

<p>不要想这种代码：</p>

<pre><code>for(int i=0;i&lt;MACLEN;i++){
    if(MAC-computed[i] != MAC-received[i])
        return MAC_IS_BAD ;
return  MAC_IS_GOOD;
</code></pre>

<p>应该这样写</p>

<pre><code>for(int i=0;i&lt;MACLEN;i++){
    x  |= (MAC-computed[i] - MAC-received[i]);

return  x?MAC_IS_BAD:MAC_IS_GOOD;
</code></pre>

<p>Google Keyczar就做错了</p>

<hr />

<p>块加密</p>

<p>对称加密通常构建在块加密算法的基础之上</p>

<p>一个理想的块加密算法使用一个key来双向地把n-bit的输入x转换成n-bit的输出Ek(x)，这样当
知道(x,Ek(x))时，对任意的(x',k')!=(x,k)，你没法以大于2^-n的概率猜出(x',Ek'(x'))</p>

<p>有时被称为“随机排列”</p>

<p>通常我们关心的是Ek(x)不透露出 当x!=x'时Ek(x')的信息。</p>

<p>如果一个攻击者可以通过观察一个块加密算法怎么处理不同key，来获取有用信息，该块加密算法
被认为可被  key相关攻击 （key-related attack）攻破。</p>

<hr />

<p>实践：</p>

<p>使用 AES-256</p>

<p>AES-256有related key攻击漏洞，但是当你把其它事情做对时，这并不是问题</p>

<p>AES-128理论上足够强壮，但是块加密算法很难没有side channel地正确实现 ，</p>

<p>并且key里面的额外bit 在key的一些bit泄露之后是有用的。</p>

<p>不要使用 blowfish</p>

<p>想都不要想使用DES</p>

<p>避免 triple-des(3des)</p>

<p>不要使用块加密算法"raw"，替代地，在一个已经建立的操作模式中使用它(?)。</p>

<hr />

<p>块加密算法操作模式</p>

<p>一个块加密算法操作模式告诉你怎么使用一个块加密算法来保护数据流</p>

<p>在很多case中，plaintext需要被填充到块大小的整数倍，块密码算法操作模式会
告诉你怎么做到这一点</p>

<p>流行的模式有: ECB ，CBC  , CFB , OFB，CTR，IAPM，CCM，EAX，GCM &hellip;</p>

<p>大多数模式只提供了加密，但也有一些提供了认证</p>

<p>实践：
使用：CTR模式</p>

<p>不要使用同时提供加密和认证的模式</p>

<p>想都不要想使用ECB</p>

<p>使用一个MAC（例如HMAC-SHA256）来认证你的加密数据</p>

<p>如果你认为你不需要这么做，咨询一个密码学专家，他会告诉你你为什么是错的。</p>

<p>验证你的加密数据的真实性，在你揭秘数据之前。</p>

<hr />

<p>非对称加密</p>

<p>一个非对称加密模式使用一个签名key来把plaintext转换成ciphertext，使用一个认证码来把
ciphertext转化成plaintext或者“错误的签名”</p>

<p>签名key不能从认证key算出，但是认证key可以从签名key算出</p>

<p>ciphertext通常由 plaintext加一个签名构成</p>

<p>如果一个攻击者接触到了验证key，并且可以说服你签名任意的plaintext，那就可以认为这个
非对称加密系统被攻破了。</p>

<hr />

<p>非对称认证</p>

<p>使用 RSASSA-PSS（RSA签名，使用Probabilistic Signature Scheme padding）</p>

<p>使用 2048-bit的RSA key，使用65537作为公钥的公共幂，和SHA256</p>

<p>不要使用 PKCS v1.5 padding</p>

<p>想都不要想 使用不带消息padding的RSA(即RAW)</p>

<p>可能避免： DSA</p>

<p>可能避免：椭圆曲线签名模式</p>

<p>想都不要想使用相同的RSA key既做认证，又做加密</p>

<hr />

<p>非对称加密</p>

<p>非对称加密类似于非对称签名，除了方向相反，使用公钥把plaintext转成ciphertext，但是要
使用私钥把ciphertext转成plaintext</p>

<p>一个</p>

<p>大多数非对称加密模式都限制能加密的消息大小到一个很低的数字以下。</p>

<hr />

<p>非对称加密</p>

<p>使用 RSAES-OAEP（RSA加密，使用Optimal Asymmeric Encryption Padding）</p>

<p>使用2048-bit的RSA key，以65537为幂底数，SHA256和MGF1-SHA256</p>

<p>不要使用 PCKS v1.5 padding</p>

<p>不要使用不带消息padding的RSA</p>

<p>生成一个随机key，用这个key使用对称加密加密你的消息，然后使用非对称加密算法加密你的key</p>

<p>小心避免RSAES-OAEP的timing攻击通道</p>

<hr />

<p>密码</p>

<p>密码通常被直接用于识别，但是也可以被用于加密或者认证。</p>

<p>实践：</p>

<p>尽可能避免密码</p>

<p>使用一个key继承函数，来尽快把密码转成key。</p>

<p>使用PBKDF2，如果你跟随流行趋势</p>

<p>使用scrypt，如果你希望2<sup>8</sup>倍地比严肃的攻击者更安全</p>

<p>想都不要想把用户的密码存储在服务器上。绝对不能，就算它们被加密了也不能。</p>

<hr />

<p>SSL</p>

<p>SSL是一个可怕的系统</p>

<p>SSL的复杂性导致它很难别安全地实现</p>

<p>SSL给了攻击者很多攻击选项</p>

<p>SSL要求你决定你想信任什么CA</p>

<p>你相信中国政府吗？</p>

<p>不幸的是，SSL是唯一可行的选项</p>

<p>实践：</p>

<p>随客户端分发非对称签名key，并且使用这个key开始你的整个密码系统</p>

<p>使用SSL加密你的网站，Email，和其他公开的标准面向Internet的服务器。</p>

<p>认真地想想你信任哪些CA。</p>

<hr />

<p>奇奇怪怪地部分：</p>

<p>咨询一个密码学专家，如果</p>

<p>你的密码学硬件设备，攻击者可以物理接触到。（例如smartcards）</p>

<p>你想使用最少的电力消耗（例如在手机上）</p>

<p>你需要处理尽可能大的数据流量（例如 10Gbps的 IPSec 隧道）</p>

<p>你需要传输尽可能少的bit（例如和一个核潜艇的通信）</p>

<p>你想忽视我在这个talk中提出的任何建议</p>

<hr />

<p>QA</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">byronhe</span></span>

      




<time class='entry-date' datetime='2015-04-12T14:05:55+00:00'><span class='date'>2015-04-12</span> <span class='time'>2:05 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/crypto/'>crypto</a>, <a class='category' href='/blog/categories/translate/'>translate</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/03/13/jump_consistent_hash/" title="Previous Post: 【翻译/介绍】jump consistent hash:零内存消耗，均匀，快速，简洁，来自Google的一致性哈希算法">&laquo; 【翻译/介绍】jump consistent hash:零内存消耗，均匀，快速，简洁，来自Google的一致性哈希算法</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/05/08/https-config-optimize-in-nginx/" title="Next Post: nginx下配置高性能，高安全性的https TLS服务">nginx下配置高性能，高安全性的https TLS服务 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/09/18/newwords_discovery/">GB 规模语料上的高性能新词发现算法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/06/tls-protocol-analysis-and-crypto-protocol-design/">TLS协议分析 与 现代加密通信协议设计</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/05/modern-crypto/">现代密码学实践指南[2015年]</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/08/https-config-optimize-in-nginx/">Nginx下配置高性能，高安全性的https TLS服务</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/12/translate-Everything-you-need-to-know-about-cryptgraphy-in-1-hour/">【翻译】密码学一小时必知</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/byronhe">@byronhe</a> on GitHub
  
  <script type="text/javascript">

    //$(document).ready(function(){
    document.addEventListener("DOMContentLoaded", function(event) { 
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'byronhe',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script async src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - byronhe -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
    <script src="/javascripts/modernizr-2.0.js"></script>
  <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
  <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
  <script async >!window.jQuery && document.write(unescape('%3Cscript async  src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script async  src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-49290834-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>




<script type="text/javascript">
      var disqus_shortname = 'byronheblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://blog.helong.info//blog/2015/04/12/translate-Everything-you-need-to-know-about-cryptgraphy-in-1-hour/';
        var disqus_url = 'https://blog.helong.info//blog/2015/04/12/translate-Everything-you-need-to-know-about-cryptgraphy-in-1-hour/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>










<script src="//s95.cnzz.com/z_stat.php?id=1256308650&web_id=1256308650" language="JavaScript"></script>

<script src="/javascripts/jquery.tableofcontents.min.js" type="text/javascript"></script>
<script src="/javascripts/toc-generator.js" type="text/javascript"></script>




</body>
</html>
